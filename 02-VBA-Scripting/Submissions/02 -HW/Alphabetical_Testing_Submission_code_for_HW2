Sub alphabetical_testing_submission_code_for_HW2()

Dim ws As Worksheet
Dim tckr As String
Dim opn_prc As Double
Dim clsd_prce As Double
Dim yrly_chng As Double
Dim prcnt_chng As Double
Dim ttl_vlm As Double
Dim SummaryTableRow As Integer
Dim LastRow As Long

'Loop through all the worksheets
For Each ws In Worksheets

'Initializing Total Volume at zero
ttl_vlm = 0

'Setting Open Price
opn_prc = ws.Cells(2, 3).Value

'Initialzing the SummaryTableRow in Row 2
SummaryTableRow = 2

'Creating Column Headers for SummaryTable
ws.Cells(1, 11).Value = "Ticker"
ws.Cells(1, 12).Value = "Yearly Change"
ws.Cells(1, 13).Value = "Percentage Change"
ws.Cells(1, 14).Value = "Total Volume"

'Find the Last Row with data
      LastRow = ws.Cells(Rows.Count, 1).End(xlUp).Row
      
'Conditional Formating to Percentages
ws.Range("M:M").NumberFormat = "0.000%"

'Conditional Formating by color with a conditional
    'If yrly_chng < 0 Then
        'ws.Cells(SummaryTableRow, 12).Interior.ColorIndex = 3
    'Else
        'ws.Cells(SummaryTableRow, 12).Interior.ColorIndex = 4
   ' End If

'Looping through until LastRow
Dim i As Long
For i = 2 To LastRow

' Searches for when the value of the next cell is different than that of the current cell
    If ws.Cells(i + 1, 1).Value <> ws.Cells(i, 1).Value Then

'Establishing ticker variable name
    tckr = ws.Cells(i, 1).Value
    
'Setting Closed Price value
    clsd_prc = ws.Cells(i, 6).Value
    
'Calculating Yearly Change = Closed Price minus Open Price
    yrly_chng = clsd_prc - opn_prc
    
'Calculating Percent Change and addressing the DIV#/0 error with the conditional
    If opn_prc > 0 Then
        prcnt_chng = yrly_chng / opn_prc
    Else
        prcnt_chng = -1
    End If
    
'Total Volume aggregated
        ttl_vlm = ttl_vlm + ws.Cells(i, 7).Value
                
'           Writing to the summary_table to start row 2
            ws.Cells(SummaryTableRow, 11).Value = tckr
            ws.Cells(SummaryTableRow, 12).Value = yrly_chng
            ws.Cells(SummaryTableRow, 13).Value = prcnt_chng
            ws.Cells(SummaryTableRow, 14).Value = ttl_vlm

'Conditional Formating to Percentages
ws.Range("M:M").NumberFormat = "0.000%"

'Conditional Formating by color with a conditional
    If yrly_chng < 0 Then
        ws.Cells(SummaryTableRow, 12).Interior.ColorIndex = 3
    Else
        ws.Cells(SummaryTableRow, 12).Interior.ColorIndex = 4
    End If
    
'Resets through the loop
        ttl_vlm = 0
        SummaryTableRow = SummaryTableRow + 1
        opn_prc = Cells(i + 1, 3).Value
        prcnt_chng = 0
        
    Else
        ttl_vlm = ttl_vlm + ws.Cells(i, 7).Value
        
    End If
    
  Next i
  
  Next
  
End Sub

'Sources for snippets of code:
        'Data types MS Docs:  https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/double-data-type
        'VBA Remove Duplicates:  https://www.educba.com/vba-remove-duplicates/
        'Change text to number using VBA:  https://www.exceltip.com/cells-ranges-rows-and-columns-in-vba/change-text-to-number-using-vba.html
        'Percent Format:  https://www.excelfunctions.net/vba-formatpercent-function.html
        'YouTube video - Averaging numbers:  https://www.youtube.com/watch?v=N8p19we5sUc&t=190s
        'VBA Error code: Statement outside block code:  https://stackoverflow.com/questions/30987487/vba-compile-error-statement-invalid-outside-type-block

